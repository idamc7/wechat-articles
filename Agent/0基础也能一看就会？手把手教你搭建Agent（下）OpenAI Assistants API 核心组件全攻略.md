ç†è§£OpenAI Assistants APIï¼ŒæŒæ¡å…¶äº”å¤§æ ¸å¿ƒç»„ä»¶æ˜¯å…³é”®ï¼š**Assistant**ã€**Thread**ã€**Message**ã€**Run** å’Œ **Tools**ã€‚å®ƒä»¬å…±åŒåä½œï¼Œæ„å»ºå¼ºå¤§çš„AIåŠ©æ‰‹åº”ç”¨ã€‚

---

## 1ï¸âƒ£ **Assistantï¼ˆåŠ©æ‰‹/æ™ºèƒ½ä½“ï¼‰ - æ™ºèƒ½ä½“çš„å®šä¹‰**

*   **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ**
    *   åˆ›å»ºAIåŠ©æ‰‹çš„**æ¨¡æ¿**ï¼ˆç±»ï¼‰ï¼Œå®šä¹‰äº†åŠ©æ‰‹çš„åŸºæœ¬èº«ä»½ã€èƒ½åŠ›å’Œè¡Œä¸ºå‡†åˆ™ã€‚
    *   **é€šä¿—æ¯”å–»ï¼š** Assistantå°±åƒä¸€ä¸ªæ²¡æœ‰çµé­‚çš„â€œ**æœºå™¨äººéª¨æ¶**â€ã€‚ä½ éœ€è¦ï¼š
        *   **æŒ‡ä»¤ (Instructions)** â¡ï¸ èµ‹äºˆå®ƒçµé­‚å’Œä¸ªæ€§
        *   **æ¨¡å‹ (Model)** â¡ï¸ èµ‹äºˆå®ƒèªæ˜çš„å¤§è„‘
        *   **å·¥å…· (Tools)** â¡ï¸ èµ‹äºˆå®ƒè¡ŒåŠ¨çš„èƒ½åŠ›ï¼ˆæ‰‹ã€è„šã€çœ¼ç›ï¼‰
        *   **æ–‡ä»¶ (Files)** â¡ï¸ èµ‹äºˆå®ƒä¸“å±çš„çŸ¥è¯†

*   **å¦‚ä½•å®šä¹‰ï¼Ÿé€šè¿‡å››éƒ¨åˆ†ï¼š**
    1.  **æŒ‡ä»¤ï¼š** å‘Šè¯‰åŠ©æ‰‹å®ƒçš„è§’è‰²ã€å›åº”æ–¹å¼ã€ä¼˜å…ˆçº§ã€‚
        *   *ä¾‹å¦‚ï¼šâ€œä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„å¤©æ°”æŸ¥è¯¢åŠ©ç†ï¼Œæ€»æ˜¯ä½¿ç”¨æ‘„æ°åº¦ã€‚â€*
        *   **ä½œç”¨ï¼š** æ˜¯LLMç”Ÿæˆå“åº”å’Œå†³ç­–çš„æ ¸å¿ƒçº¦æŸã€‚
    2.  **æ¨¡å‹ï¼š** é€‰æ‹©åŠ©æ‰‹ä½¿ç”¨çš„**LLMæ¨¡å‹**ï¼ˆå¦‚`gpt-4o`, `gpt-3.5-turbo`ï¼‰ã€‚
        *   **ä½œç”¨ï¼š** æä¾›æ ¸å¿ƒçš„è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œæ˜¯åŠ©æ‰‹çš„â€œ**å¤§è„‘**â€ã€‚
    3.  **å·¥å…·ï¼š** å¯ç”¨æˆ–å®šä¹‰åŠ©æ‰‹èƒ½ä½¿ç”¨çš„åŠŸèƒ½ã€‚
        *   **Function Calling (å‡½æ•°è°ƒç”¨)ï¼š** é€šè¿‡JSON Schemaå®šä¹‰å¤–éƒ¨å‡½æ•°æ¥å£ã€‚åŠ©æ‰‹å­¦ä¹ ä½•æ—¶/å¦‚ä½•è°ƒç”¨ä»¥æ‰§è¡Œå¤–éƒ¨ä»»åŠ¡ï¼ˆæŸ¥æ•°æ®åº“ã€å‘é‚®ä»¶ï¼‰ã€‚
        *   **Code Interpreter (ä»£ç è§£é‡Šå™¨)ï¼š** å¯ç”¨åï¼ŒåŠ©æ‰‹å¯åœ¨æ²™ç›’ä¸­ç¼–å†™/æ‰§è¡ŒPythonä»£ç ï¼Œç”¨äºæ•°æ®åˆ†æã€è®¡ç®—ã€ç»˜å›¾ç­‰ã€‚
        *   **File Search (æ–‡ä»¶æœç´¢/æ£€ç´¢)ï¼š** å¯ç”¨å¹¶ä¸Šä¼ æ–‡ä»¶åï¼ŒåŠ©æ‰‹å¯ä»ä½ çš„æ–‡æ¡£ä¸­æ£€ç´¢ä¿¡æ¯å›ç­”é—®é¢˜ï¼Œå®ç°**RAG**ã€‚
    4.  **æ–‡ä»¶ï¼š** ä¸Šä¼ æ–‡æ¡£ï¼ˆPDF, CSVç­‰ï¼‰å¹¶ä¸åŠ©æ‰‹å…³è”ï¼Œä¾›**File Search**å·¥å…·ä½¿ç”¨ã€‚

> **æ€»ç»“ï¼š** Assistantæ˜¯ä¸€ä¸ª**æ— çŠ¶æ€çš„æ¨¡æ¿**ã€‚å®ƒå®šä¹‰äº†æ™ºèƒ½ä½“â€œ**èƒ½åšä»€ä¹ˆ**â€å’Œâ€œ**åº”è¯¥æ€ä¹ˆåš**â€ï¼Œä½†ä¸åŒ…å«å…·ä½“å¯¹è¯å†å²ã€‚

---

## 2ï¸âƒ£ **Threadï¼ˆä¼šè¯ï¼‰ - æŒä¹…åŒ–çš„å¯¹è¯å†å²**

*   **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ**
    *   Assistantä¸ç”¨æˆ·ä¹‹é—´**å•æ¬¡å¯¹è¯çš„æŒä¹…åŒ–å®¹å™¨**ã€‚
    *   **è§£å†³ç—›ç‚¹ï¼š** çœå»ä¼ ç»ŸLLM APIè°ƒç”¨ä¸­æ‰‹åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡çš„éº»çƒ¦ã€‚

*   **æ ¸å¿ƒèƒ½åŠ›ï¼š**
    *   **æ¶ˆæ¯å­˜å‚¨ï¼š** è‡ªåŠ¨å­˜å‚¨æ‰€æœ‰ç”¨æˆ·å’ŒAssistantä¹‹é—´çš„**Message**ã€‚æ— éœ€æ¯æ¬¡è¯·æ±‚ä¼ é€’å®Œæ•´å†å²ã€‚
    *   **ä¸Šä¸‹æ–‡ç®¡ç†ï¼š** OpenAIæœåŠ¡å™¨åå°ç®¡ç†Threadä¸­çš„æ¶ˆæ¯ã€‚æ¯æ¬¡Runæ—¶ï¼Œæä¾›ç›¸å…³ä¸”æœ€è¿‘çš„ä¸Šä¸‹æ–‡ç»™LLMï¼ˆå³ä½¿å¯¹è¯å¾ˆé•¿ï¼‰ï¼Œä¼˜åŒ–Tokenä½¿ç”¨ï¼Œä¿è¯è¿è´¯æ€§ã€‚
    *   **ç‹¬ç«‹æ€§ï¼š** æ¯ä¸ªç”¨æˆ·æˆ–ç‹¬ç«‹å¯¹è¯åº”æœ‰ç‹¬ç«‹çš„Threadï¼Œé¿å…ä¸Šä¸‹æ–‡æ··æ·†ã€‚

> **æ€»ç»“ï¼š** Threadæ˜¯ä¸€ä¸ª**æœ‰çŠ¶æ€çš„å®¹å™¨**ï¼Œç®¡ç†ç€æ¶ˆæ¯åºåˆ—å¹¶æä¾›**æŒä¹…åŒ–çš„ä¸Šä¸‹æ–‡**ã€‚

---

## 3ï¸âƒ£ **Messageï¼ˆæ¶ˆæ¯ï¼‰ - å¯¹è¯çš„åŸå­å•å…ƒ**

*   **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ**
    *   æ„æˆThreadå†å²çš„**åŸºæœ¬å¯¹è¯å•å…ƒ**ã€‚æ¥æºå¯ä»¥æ˜¯ç”¨æˆ·æˆ–Assistantã€‚

*   **ä¸»è¦ç»„æˆï¼š**
    *   **è§’è‰²ï¼š** æ ‡æ˜æ¶ˆæ¯æ¥æºã€‚
        *   `user` (ç”¨æˆ·)
        *   `assistant` (åŠ©æ‰‹)
        *   `tool` (å·¥å…·æ‰§è¡Œç»“æœ - åœ¨å·¥å…·è°ƒç”¨æµç¨‹ä¸­å‡ºç°)
    *   **å†…å®¹ï¼š** æ¶ˆæ¯çš„å®é™…æ–‡æœ¬å†…å®¹ã€‚å·¥å…·è°ƒç”¨æ—¶ï¼Œä¼šåŒ…å«`tool_calls`æˆ–`tool_outputs`ç­‰ç»“æ„åŒ–å†…å®¹ã€‚
    *   **æ–‡ä»¶é™„ä»¶ï¼š** å¯åŒ…å«ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æˆ–Assistantç”Ÿæˆçš„å›¾ç‰‡ç­‰ã€‚

> **æ€»ç»“ï¼š** Messageæ˜¯Threadå†å²çš„**åŸºæœ¬æ•°æ®å•å…ƒ**ã€‚

---

## 4ï¸âƒ£ **Runï¼ˆè¿è¡Œï¼‰ - æ™ºèƒ½ä½“çš„æ‰§è¡Œå¼•æ“**

*   **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ**
    *   åœ¨ç‰¹å®šThreadä¸Š**é©±åŠ¨Assistantæ‰§è¡Œæ“ä½œ**çš„å®ä¾‹ã€‚æ˜¯æ€è€ƒå’Œè¡ŒåŠ¨çš„å¼•æ“ã€‚

*   **æ‰§è¡Œæµç¨‹ï¼ˆè¿­ä»£å¾ªç¯ï¼‰ï¼š**
    1.  **åˆå§‹åŒ–ï¼š** Assistantè·å–Threadçš„æœ€æ–°æ¶ˆæ¯å’Œå®Œæ•´å†å²ã€‚
    2.  **LLMæ¨ç†ï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼š**
        *   LLMç»“åˆInstructionsã€Threadå†å²å’ŒToolsè¿›è¡Œæ¨ç†ã€‚
        *   **è‹¥å¯ç›´æ¥å›å¤ï¼š** ç”Ÿæˆæ–‡æœ¬å›å¤ â†’ RunçŠ¶æ€å˜ä¸º `completed`ã€‚
        *   **è‹¥éœ€è°ƒç”¨å·¥å…·ï¼š** ç”Ÿæˆå·¥å…·è°ƒç”¨è¯·æ±‚(`tool_calls`) â†’ RunçŠ¶æ€å˜ä¸º `requires_action`ã€‚
    3.  **å¤„ç† `requires_action` (å¼€å‘è€…ä»‹å…¥)ï¼š**
        *   ä½ çš„åº”ç”¨æå–`tool_calls`ï¼ˆå‡½æ•°åå’Œå‚æ•°ï¼‰ã€‚
        *   åœ¨ä½ çš„ç¯å¢ƒä¸­**å®é™…æ‰§è¡Œ**è¿™äº›å‡½æ•°/å·¥å…·ã€‚
        *   å°†æ‰§è¡Œç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰é€šè¿‡`submit_tool_outputs`æäº¤å›APIã€‚
    4.  **LLMæ¨ç†ï¼ˆç¬¬äºŒæ¬¡æˆ–å¤šæ¬¡ï¼‰ï¼š**
        *   APIå°†å·¥å…·è¾“å‡ºä½œä¸ºæ–°ä¸Šä¸‹æ–‡åŠ å…¥Threadã€‚
        *   Run**è‡ªåŠ¨é‡å¯**ï¼ŒLLMå†æ¬¡æ¨ç†ï¼ˆå·²è·å·¥å…·åé¦ˆï¼‰ã€‚
        *   LLMå¯èƒ½ï¼šç”Ÿæˆæœ€ç»ˆå›å¤ï¼Œæˆ–å†³å®šå†æ¬¡è°ƒç”¨å…¶ä»–å·¥å…·ï¼ˆå›åˆ°æ­¥éª¤3ï¼‰ã€‚
    5.  **å®Œæˆï¼š**
        *   å½“LLMç”Ÿæˆæœ€ç»ˆæ–‡æœ¬å›å¤ä¸”æ— éœ€è¿›ä¸€æ­¥å·¥å…·è°ƒç”¨ â†’ RunçŠ¶æ€å˜ä¸º `completed`ã€‚
        *   æ­¤æ—¶å¯ä»Threadè·å–Assistantçš„æœ€æ–°å›å¤Messageã€‚

> **æ€»ç»“ï¼š** Runæ˜¯æ‰§è¡Œæ™ºèƒ½é€»è¾‘çš„**é©±åŠ¨å™¨**ï¼Œç¼–æ’äº†LLMæ¨ç†ã€å·¥å…·è°ƒç”¨ã€ç»“æœåé¦ˆå’Œå›å¤ç”Ÿæˆçš„**å¤šæ­¥å¾ªç¯**ã€‚

---

## 5ï¸âƒ£ **Toolsï¼ˆå·¥å…·ï¼‰ - æ™ºèƒ½ä½“çš„å¤–éƒ¨æ¥å£**

*   **å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ**
    *   æ˜¯LLMæ¨ç†èƒ½åŠ›ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„â€œ**æ¡¥æ¢**â€ã€‚
    *   ä¸ºAssistantå®šä¹‰çš„ç‰¹å®šåŠŸèƒ½ã€‚

*   **ç±»å‹ï¼š**
    *   **è‡ªå®šä¹‰å·¥å…· (Function Calling)ï¼š** å¼€å‘è€…å®šä¹‰çš„å‡½æ•°/ç±»ã€‚
    *   **å†…ç½®å·¥å…·ï¼š**
        1.  **Code Interpreter (ä»£ç è§£é‡Šå™¨)ï¼š** æ²™ç›’åŒ–Pythonç¯å¢ƒï¼Œæ‰§è¡Œä»£ç ã€å¤„ç†æ•°æ®ã€ç”Ÿæˆå›¾è¡¨ã€‚LLMç›´æ¥ç”Ÿæˆä»£ç ç”±å®ƒæ‰§è¡Œã€‚
        2.  **File Search (æ–‡ä»¶æœç´¢/RAG)ï¼š** æ£€ç´¢ä¸Šä¼ æ–‡ä»¶å†…å®¹ã€‚LLMæ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œåœ¨æ–‡ä»¶ä¸­æœç´¢ç›¸å…³ä¿¡æ¯æ¥å›ç­”ã€‚

> **æ€»ç»“ï¼š** Toolsæ˜¯Assistantè¶…è¶Šå…¶è®­ç»ƒæ•°æ®å’Œæ ¸å¿ƒè¯­è¨€èƒ½åŠ›ï¼Œä¸çœŸå®ä¸–ç•Œå’Œç‰¹å®šæ•°æ®äº¤äº’çš„â€œ**æ¡¥æ¢**â€ã€‚

---

## å®Œæ•´ä»£ç ç¤ºä¾‹ ##
```python
# -*- coding: utf-8 -*-

"""

OpenAI Assistants API å®Œæ•´ç¤ºä¾‹ï¼šæ™ºèƒ½ç§äººåŠ©ç†

æ•´åˆæ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆAssistant/Thread/Message/Run/Toolsï¼‰

"""



# ===================== åˆå§‹åŒ–è®¾ç½® =====================

importÂ openai

importÂ time

importÂ json

importÂ os



# ğŸ”‘ æ³¨æ„ï¼šå®é™…ä½¿ç”¨è¯·é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®APIå¯†é’¥ï¼ˆæ›´å®‰å…¨ï¼‰

# ç¤ºä¾‹ï¼šopenai.api_key = os.getenv("OPENAI_API_KEY")

openai.api_key =Â "YOUR_OPENAI_API_KEY"Â Â # âš ï¸æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†é’¥

client = openai.OpenAI(api_key=openai.api_key)



print("ğŸš€ æ™ºèƒ½ç§äººåŠ©ç†å¯åŠ¨ä¸­ï¼šæ•´åˆæ‰€æœ‰æ ¸å¿ƒç»„ä»¶...")



# ===================== å·¥å…·å‡½æ•°å®šä¹‰ =====================

# ğŸ”§ å®é™…å·¥å…·å®ç°ï¼ˆå¯¹åº”Function Callingï¼‰



defÂ get_current_time() ->Â str:

Â  Â Â """ğŸ•’ è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´"""

Â  Â Â print(" Â  Â [å·¥å…·è°ƒç”¨] æ­£åœ¨è·å–å½“å‰æ—¶é—´...")

Â  Â Â returnÂ json.dumps({"current_time":Â "2025å¹´6æœˆ10æ—¥ æ˜ŸæœŸä¸€ ä¸Šåˆ10:30 PDT"})



defÂ get_current_weather(location:Â str, unit:Â strÂ =Â "celsius") ->Â str:

Â  Â Â """â˜€ï¸ è·å–æŒ‡å®šåœ°ç‚¹å¤©æ°”"""

Â  Â Â print(f" Â  Â [å·¥å…·è°ƒç”¨] æ­£åœ¨æŸ¥è¯¢Â {location}Â çš„å¤©æ°”...")

Â  Â Â # æ¨¡æ‹Ÿä¸åŒåŸå¸‚çš„å¤©æ°”æ•°æ®

Â  Â  weather_data = {

Â  Â  Â  Â Â "åŒ—äº¬": {"temperature":Â "25",Â "forecast":Â "æ™´æœ—ï¼Œå¾®é£"},

Â  Â  Â  Â Â "ä¸Šæµ·": {"temperature":Â "28",Â "forecast":Â "å¤šäº‘è½¬é˜´"},

Â  Â  Â  Â Â "çº½çº¦": {"temperature":Â "70",Â "unit":Â "fahrenheit",Â "forecast":Â "å±€éƒ¨å¤šäº‘"}

Â  Â  }

Â  Â Â ifÂ locationÂ inÂ weather_data:

Â  Â  Â  Â Â returnÂ json.dumps({"location": location, **weather_data[location]})

Â  Â Â returnÂ json.dumps({"location": location,Â "temperature":Â "æœªçŸ¥",Â "forecast":Â "æ— æ³•è·å–"})



defÂ send_simple_email(to_email:Â str, subject:Â str, body:Â str) ->Â str:

Â  Â Â """âœ‰ï¸ å‘é€ç®€å•é‚®ä»¶ï¼ˆæ¨¡æ‹Ÿï¼‰"""

Â  Â Â print(f" Â  Â [å·¥å…·è°ƒç”¨] æ­£åœ¨å‘é€é‚®ä»¶åˆ°Â {to_email}...")

Â  Â Â ifÂ "@"Â inÂ to_emailÂ andÂ "."Â inÂ to_email:

Â  Â  Â  Â Â print(f" Â  Â [é‚®ä»¶å‘é€æˆåŠŸ] æ”¶ä»¶äºº:Â {to_email}\n Â  Â  Â ä¸»é¢˜:Â {subject}\n Â  Â  Â å†…å®¹:Â {body[:50]}...")

Â  Â  Â  Â Â returnÂ json.dumps({"status":Â "success",Â "message":Â f"é‚®ä»¶å·²å‘é€è‡³Â {to_email}"})

Â  Â Â returnÂ json.dumps({"status":Â "failure",Â "message":Â f"æ— æ•ˆé‚®ç®±åœ°å€ï¼š{to_email}"})



# ğŸ“š å·¥å…·åç§°åˆ°å‡½æ•°çš„æ˜ å°„

TOOL_MAP = {

Â  Â Â "get_current_time": get_current_time,

Â  Â Â "get_current_weather": get_current_weather,

Â  Â Â "send_simple_email": send_simple_email,

}



# ===================== åˆ›å»ºåŠ©æ‰‹ï¼ˆAssistantï¼‰ =====================

print("\nğŸ”§ æ­¥éª¤1ï¼šåˆ›å»ºåŠ©æ‰‹ï¼ˆAssistantï¼‰- å®šä¹‰æ™ºèƒ½ä½“èƒ½åŠ›")



# ğŸ“ å·¥å…·é…ç½®ï¼ˆJSON Schemaï¼‰

TOOL_CONFIG = [

Â  Â  {

Â  Â  Â  Â Â "type":Â "function",

Â  Â  Â  Â Â "function": {

Â  Â  Â  Â  Â  Â Â "name":Â "get_current_time",

Â  Â  Â  Â  Â  Â Â "description":Â "è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´",

Â  Â  Â  Â  Â  Â Â "parameters": {"type":Â "object",Â "properties": {}}

Â  Â  Â  Â  }

Â  Â  },

Â  Â  {

Â  Â  Â  Â Â "type":Â "function",

Â  Â  Â  Â Â "function": {

Â  Â  Â  Â  Â  Â Â "name":Â "get_current_weather",

Â  Â  Â  Â  Â  Â Â "description":Â "è·å–æŒ‡å®šåœ°ç‚¹å¤©æ°”",

Â  Â  Â  Â  Â  Â Â "parameters": {

Â  Â  Â  Â  Â  Â  Â  Â Â "type":Â "object",

Â  Â  Â  Â  Â  Â  Â  Â Â "properties": {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "location": {"type":Â "string",Â "description":Â "åŸå¸‚åç§°ï¼Œå¦‚'åŒ—äº¬'ã€'çº½çº¦'"},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "unit": {"type":Â "string",Â "enum": ["celsius",Â "fahrenheit"]}

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â Â "required": ["location"]

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  },

Â  Â  {

Â  Â  Â  Â Â "type":Â "function",

Â  Â  Â  Â Â "function": {

Â  Â  Â  Â  Â  Â Â "name":Â "send_simple_email",

Â  Â  Â  Â  Â  Â Â "description":Â "å‘é€ç®€å•é‚®ä»¶",

Â  Â  Â  Â  Â  Â Â "parameters": {

Â  Â  Â  Â  Â  Â  Â  Â Â "type":Â "object",

Â  Â  Â  Â  Â  Â  Â  Â Â "properties": {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "to_email": {"type":Â "string",Â "description":Â "æ”¶ä»¶äººé‚®ç®±"},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "subject": {"type":Â "string",Â "description":Â "é‚®ä»¶ä¸»é¢˜"},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "body": {"type":Â "string",Â "description":Â "é‚®ä»¶æ­£æ–‡"}

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â Â "required": ["to_email",Â "subject",Â "body"]

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  }

]



# ğŸ¤– åˆ›å»ºåŠ©æ‰‹å®ä¾‹

assistant = client.beta.assistants.create(

Â  Â  name="æ™ºèƒ½ç§äººåŠ©ç†",

Â  Â  instructions="ä½ æ˜¯å‹å¥½çš„ç§äººåŠ©ç†ï¼Œå¯ä»¥å›ç­”é—®é¢˜ã€æŸ¥è¯¢æ—¶é—´/å¤©æ°”ã€å‘é€é‚®ä»¶ã€‚æ³¨æ„ï¼šæŸ¥è¯¢å¤©æ°”éœ€æ˜ç¡®åœ°ç‚¹ï¼Œå‘é€é‚®ä»¶éœ€å®Œæ•´ä¿¡æ¯ã€‚",

Â  Â  model="gpt-4o",

Â  Â  tools=TOOL_CONFIG

)

print(f" Â åŠ©æ‰‹åˆ›å»ºæˆåŠŸï¼ID:Â {assistant.id}")



# ===================== åˆ›å»ºä¼šè¯ï¼ˆThreadï¼‰ =====================

print("\nğŸ“’ æ­¥éª¤2ï¼šåˆ›å»ºä¼šè¯ï¼ˆThreadï¼‰- åˆå§‹åŒ–å¯¹è¯ä¸Šä¸‹æ–‡")

thread = client.beta.threads.create()

print(f" Â ä¼šè¯åˆ›å»ºæˆåŠŸï¼ID:Â {thread.id}")



# ===================== æ ¸å¿ƒäº¤äº’å‡½æ•° =====================

defÂ chat_with_assistant(user_input:Â str):

Â  Â Â """ğŸ’¬ æ‰§è¡Œå®Œæ•´å¯¹è¯æµç¨‹ï¼ˆæ¶ˆæ¯â†’è¿è¡Œâ†’å·¥å…·è°ƒç”¨â†’å“åº”ï¼‰"""

Â  Â Â print(f"\nğŸ‘¤ ç”¨æˆ·æé—®:Â {user_input}")



Â  Â Â # ğŸ“© æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆMessageï¼‰

Â  Â  client.beta.threads.messages.create(

Â  Â  Â  Â  thread_id=thread.id,

Â  Â  Â  Â  role="user",

Â  Â  Â  Â  content=user_input

Â  Â  )



Â  Â Â # ğŸš¦ å¯åŠ¨è¿è¡Œï¼ˆRunï¼‰

Â  Â  run = client.beta.threads.runs.create(

Â  Â  Â  Â  thread_id=thread.id,

Â  Â  Â  Â  assistant_id=assistant.id

Â  Â  )

Â  Â Â print(f" Â å¯åŠ¨è¿è¡Œï¼ˆID:Â {run.id}ï¼‰ï¼Œå½“å‰çŠ¶æ€:Â {run.status}")



Â  Â Â # ğŸ”„ çŠ¶æ€è½®è¯¢ï¼ˆç­‰å¾…æ‰§è¡Œç»“æœï¼‰

Â  Â Â whileÂ run.statusÂ inÂ ["queued",Â "in_progress",Â "retrying"]:

Â  Â  Â  Â  time.sleep(0.5)

Â  Â  Â  Â  run = client.beta.threads.runs.retrieve(

Â  Â  Â  Â  Â  Â  thread_id=thread.id,Â 

Â  Â  Â  Â  Â  Â  run_id=run.id

Â  Â  Â  Â  )



Â  Â Â # âš™ï¸ å¤„ç†å·¥å…·è°ƒç”¨è¯·æ±‚

Â  Â Â ifÂ run.status ==Â "requires_action":

Â  Â  Â  Â Â print("\nğŸ› ï¸ æ£€æµ‹åˆ°å·¥å…·è°ƒç”¨è¯·æ±‚ï¼ˆrequires_actionï¼‰")

Â  Â  Â  Â  tool_outputs = []



Â  Â  Â  Â Â # éå†æ‰€æœ‰éœ€è¦è°ƒç”¨çš„å·¥å…·

Â  Â  Â  Â Â forÂ tool_callÂ inÂ run.required_action.submit_tool_outputs.tool_calls:

Â  Â  Â  Â  Â  Â  func_name = tool_call.function.name

Â  Â  Â  Â  Â  Â  func_args = json.loads(tool_call.function.arguments)



Â  Â  Â  Â  Â  Â Â print(f" Â â†’ è°ƒç”¨å·¥å…·:Â {func_name}ï¼Œå‚æ•°:Â {func_args}")



Â  Â  Â  Â  Â  Â Â # æ‰§è¡Œå®é™…å·¥å…·å‡½æ•°

Â  Â  Â  Â  Â  Â Â ifÂ func_nameÂ inÂ TOOL_MAP:

Â  Â  Â  Â  Â  Â  Â  Â  result = TOOL_MAP[func_name](**func_args)

Â  Â  Â  Â  Â  Â  Â  Â  tool_outputs.append({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "tool_call_id": tool_call.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â "output": result

Â  Â  Â  Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  Â  Â  Â Â print(f" Â â† å·¥å…·è¿”å›:Â {result}")



Â  Â  Â  Â Â # ğŸ“¤ æäº¤å·¥å…·æ‰§è¡Œç»“æœ

Â  Â  Â  Â  run = client.beta.threads.runs.submit_tool_outputs(

Â  Â  Â  Â  Â  Â  thread_id=thread.id,

Â  Â  Â  Â  Â  Â  run_id=run.id,

Â  Â  Â  Â  Â  Â  tool_outputs=tool_outputs

Â  Â  Â  Â  )



Â  Â  Â  Â Â # ğŸ”„ å†æ¬¡ç­‰å¾…è¿è¡Œå®Œæˆ

Â  Â  Â  Â Â whileÂ run.statusÂ inÂ ["queued",Â "in_progress"]:

Â  Â  Â  Â  Â  Â  time.sleep(0.5)

Â  Â  Â  Â  Â  Â  run = client.beta.threads.runs.retrieve(

Â  Â  Â  Â  Â  Â  Â  Â  thread_id=thread.id,Â 

Â  Â  Â  Â  Â  Â  Â  Â  run_id=run.id

Â  Â  Â  Â  Â  Â  )



Â  Â Â # ğŸ’¡ è·å–æœ€ç»ˆå›å¤

Â  Â Â ifÂ run.status ==Â "completed":

Â  Â  Â  Â  messages = client.beta.threads.messages.list(

Â  Â  Â  Â  Â  Â  thread_id=thread.id,

Â  Â  Â  Â  Â  Â  order="desc",

Â  Â  Â  Â  Â  Â  limit=1

Â  Â  Â  Â  )

Â  Â  Â  Â  last_msg = messages.data[0]



Â  Â  Â  Â Â ifÂ last_msg.role ==Â "assistant":

Â  Â  Â  Â  Â  Â Â forÂ contentÂ inÂ last_msg.content:

Â  Â  Â  Â  Â  Â  Â  Â Â ifÂ content.typeÂ ==Â 'text':

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â print(f"\nğŸ¤– åŠ©ç†å›å¤:Â {content.text.value}")

Â  Â  Â  Â Â else:

Â  Â  Â  Â  Â  Â Â print("âš ï¸ æœ€æ–°æ¶ˆæ¯éåŠ©ç†å›å¤")

Â  Â Â else:

Â  Â  Â  Â Â print(f"âŒ è¿è¡Œå¤±è´¥ï¼Œæœ€ç»ˆçŠ¶æ€:Â {run.status}")



# ===================== å¯¹è¯æ¼”ç¤º =====================

print("\n"Â +Â "="*50)

print("ğŸ’¬ å¼€å§‹æ™ºèƒ½å¯¹è¯æ¼”ç¤º")

print("="*50)



chat_with_assistant("ä½ å¥½ï¼Œä½ æ˜¯è°ï¼Ÿ")

chat_with_assistant("ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ")

chat_with_assistant("å¸®æˆ‘æŸ¥ä¸€ä¸‹åŒ—äº¬çš„å¤©æ°”")

chat_with_assistant("å‘é‚®ä»¶åˆ° test@example.comï¼Œä¸»é¢˜'ä¼šè®®é€šçŸ¥'ï¼Œå†…å®¹'æ˜å¤©10ç‚¹å¼€ä¼š'")

chat_with_assistant("ä¸Šæµ·å¤©æ°”å¦‚ä½•ï¼Ÿ")

chat_with_assistant("å‘é‚®ä»¶ç»™ 'invalid-email'ï¼Œä¸»é¢˜'æµ‹è¯•'ï¼Œå†…å®¹'æµ‹è¯•å†…å®¹'")



print("\n"Â +Â "="*50)

print("ğŸ‰ å¯¹è¯æ¼”ç¤ºç»“æŸ")

print("="*50)



print("\nâœ… ç¤ºä¾‹è¿è¡Œå®Œæ¯•ï¼")
```
